#!/usr/bin/env bash
# Author: Daniel Rode
# Name: Cleanup Drive Space
# Dependencies:
#   ~/code/rmtrash
# Created: 10 Oct 2025
# Updated: 23 Dec 2025


# Description: Remove various caches and old unneeded files to clear up disk
# space.
# 
# Tags: makespace, cache, rm


# Purge trash files that are 99 dasy old and older
~/code/bin/rmtrash 99

# Remove unneeded flatpaks
flatpak uninstall --unused

# Remove old kernel versions
if command -v vkpurge &>/dev/null
then
    sudo vkpurge rm all
fi

# Remove package manager cache and orphaned packages
if command -v vpm &>/dev/null
then
    sudo vpm cleanup
    sudo vpm autoremove
fi

# Remove package manager cache and orphaned packages
if command -v vpm &>/dev/null
then
    sudo dnf clean all
    sudo dnf autoremove
fi

# Remove orphaned Podman volumes, networks, and images
podman volume prune
podman network prune
podman builder prune
podman image prune

# TODO Deduplicate data
# fclones group --hidden --no-ignore --cache --min 16384 --output ./dupes.txt "$HOME"
# # Add `--threads 1` flag if dir to dedup ($HOME, in example above) is stored on spinning HDD.
# # fclones can use btrfs reflink feature, but if you want block-based (rather than file-based) dedup, use the `bees` utility
