#!/usr/bin/env bash
# Author: Daniel Rode
# Name: Import Photos
# Type: file management
# Description: Assists with the import of photos (and videos) from various
#			   devices into my photo library
# Version: 1.3 BETA
# Init: 05 Jan 2019
# Updated: 27 Dec 2020


echo "WARNING: this script has not been adequately tested!"


# Variables
pth_library="$HOME/media/camera_library/"
pth_imptmp="$pth_library/import_temp/"


# Import photos from Canon T6i
if [[ "$1" == "t6i" ]]
then

	# Setup workspace
	mkdir "$pth_imptmp"

	# Mount SD card
	gio mount -d /dev/mmcblk0p1

	# Copy photos and videos from SD card to internal disk
	rsync --times --recursive --progress \
		/run/media/daniel/EOS_DIGITAL/DCIM/100CANON/ "$pth_imptmp"

	echo
	echo "In the Geeqie (image viewer) window that just opened, skim" \
		 "through the photos and delete any that you do not want to include" \
		 "in your library."
	echo
	echo "Once complete, CLOSE Geeqie to proceed..."
	geeqie "$pth_imptmp"

	# Wipe the SD card
	read -p "WARNING: SD CARD will be wiped. Press ENTER to proceed..."
	rm -fr /run/media/daniel/EOS_DIGITAL/*

	# Unmount SD card
	gio mount -u /run/media/daniel/EOS_DIGITAL

	# Sort images into a YYYY/MM/DD directory structure; places them in my
	# photo library
	# NOTE: This will place any videos from your camera into your photo
	# library too.
	exiftool -v '-Directory<DateTimeOriginal' \
		-d "$pth_library/%Y/%m/%d" \
		-r "$pth_imptmp"

	# Tell user to cleanup
	echo "Verify that 'import_temp' directory is empty, then delete it."

# Import photos from OnePlus (Android) phone
elif [[ "$1" ==  "oneplus" ]]
then

	echo
	echo "Connect your OnePlus device via USB."
	echo
	echo "On your Android device:"
	echo " 1. Make sure Google Photos has completed backup."
	echo " 2. Make sure ADB is enabled."
	echo
	read -p "Once complete, press ENTER to proceed..."

	# Setup workspace
	mkdir "$pth_imptmp"

	# Copy photos and videos from phone to internal disk
	sudo adb start-server
	adb pull /storage/emulated/0/DCIM "$pth_imptmp"

	echo
	echo "In the Geeqie (image viewer) window that just opened:"
	echo "- Delete any photos and videos that you don't want to include in" \
		 "your library."
	echo "- Move any photos that others have taken to another directory to" \
		 "manually organize them outside of your main library later."
	echo "- Move any VLogs to ~/media/blob - VLogs/*. (Videos do not show" \
		  "up in Geeqie, so they will need to be browsed separately.)"
	echo
	echo "Once complete, CLOSE Geeqie to proceed"
	geeqie "$pth_imptmp"

	# Sort images into a YYYY/MM/DD directory structure; places them in my
	# photo library
	# NOTE: This will place any videos from your camera into your photo
	# library too.
	exiftool -v '-Directory<DateTimeOriginal' \
		-d "$pth_library/%Y/%m/%d" \
		-r "$pth_imptmp"

	# Tell user to delete photos from Android device and to cleanup
	# import_temp
	echo "Verify that 'import_temp' directory is empty, then delete it."
	echo "On Android device, delete DCIM directory"

else

	echo "No valid option specified"
	echo "Options:"
	echo "- oneplus"
	echo "- t6i"
	exit 1

fi
